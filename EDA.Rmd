---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

```{r}
library(ggplot2)
library(doBy)

```
Script Stat Functions
```{r}
siterange <- function(x){c(length(x), min(x), mean(x), max(x))}
```

```{r}
df = read.csv("dds_datasets/nyt2.csv")

# Bin people by age groups
age_cat = c(-Inf, 18, 24, 34, 44, 54, 64, Inf)
df$Age_Cat = cut(df$Age, age_cat)

#Add click-through-rate column
df$ctr = df$Clicks/df$Impressions
head(df,10)
# summaryBy(Gender+Signed_In+Impressions+Clicks~Age_Cat,data =df)

```

Get Some Stats
The goal is to try and uncover some of the trends for the effectiveness of the adds on the NYT website. 
Here, we get a summary of the relationship between age categories and the click-through rate. 
It's interesting to see that the 18-24 age group has the lower CTR... let's investigate this a little further (like breaking it down by gender)
```{r}
df2 = subset(df, Impressions > 0)
summaryBy(ctr ~ Age_Cat, data=df2, FUN=siterange)

```

Based on the results below, the females in between ages 18-24 have absolute minimum click through rate...
```{r results='hold'}
summaryBy(ctr ~ Gender + Age_Cat, data=df2, FUN=siterange)
```

Visualize Age Groups
```{r}
ggplot(data=subset(df2, ctr>0), aes(x=Age_Cat, y=ctr, fill=factor(Gender))) +
  geom_boxplot() 
  # ylim(0,0.3)
```

```{r}
summaryBy(Age~Age_Cat, data =df, FUN=siterange)

df$hasimps <-cut(df$Impressions,c(-Inf,0,Inf))
summaryBy(Clicks~hasimps + Gender, data =df, FUN=siterange)

ggplot(subset(df, Impressions>0), aes(x=Clicks/Impressions, colour=Age_Cat)) +
  geom_density()
ggplot(subset(df, Clicks>0), aes(x=Clicks/Impressions,colour=Age_Cat)) +
  geom_density()
ggplot(subset(df, Clicks>0), aes(x=Age_Cat, y=Clicks, fill=Age_Cat)) +
  geom_boxplot()
ggplot(subset(df, Clicks>0), aes(x=Clicks, colour=Age_Cat)) +
  geom_density()


```

```{r}

```

